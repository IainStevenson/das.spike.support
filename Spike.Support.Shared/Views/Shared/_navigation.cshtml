@using Spike.Support.Shared.Models
@{
    Menu menu = (ViewBag ?? new { }).Menu ?? new Menu() { NavItems = new List<NavItem>() };
    var menuItems = menu.NavItems;

    var activeMenuItemKey = menu.ActiveMenuItemKeys.Last();
    var activeMenuRoot = menuItems.FirstOrDefault(x => x.Key == menu.ActiveMenuRootKey);

    var orientation = menu.ActiveMenuItemKeys.Count()  % 2 == 0 ? "" : "flex-column";
    
    // if we have nav items and we have the root item
    if (menu.NavItems.Count > 0 && activeMenuRoot != null)
    {
        var isActive = activeMenuItemKey == activeMenuRoot.Key ? "active" : "";

        /* The selected (active) menu item should have submenus' to display
            as a pill based sub menu across the top of the payments*/

        <ul class="nav nav-pills @orientation">
            <li class="nav-item">
                <a class="nav-link @isActive"
                   id="@activeMenuRoot.Key"
                   href="@activeMenuRoot.NavigateUrl">
                    @activeMenuRoot.Text
                </a>
            </li>
            @foreach (var subMenuItem in activeMenuRoot.NavItems)
            {
                isActive = subMenuItem.Key == activeMenuItemKey ? "active" : "";
                <li class="nav-item">
                    <a class="nav-link @isActive"
                       id="@subMenuItem.Key"
                       href="@subMenuItem.NavigateUrl">@subMenuItem.Text</a>
                </li>
            }
        </ul>

    }
}
